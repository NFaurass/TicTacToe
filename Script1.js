(function(r,o){"use strict";function a(e,t,r,o){ga("send","event",e,t,r,o)}r.onerror=function(e,t,r){if(e){a("Error",e,t&&r?"["+t+":"+r+"]":"",true)}return false};r.AudioContext=r.AudioContext||r.webkitAudioContext;var s=function(e){try{var t="_";e.setItem(t,t);e.removeItem(t);return true}catch(e){return false}}(r.localStorage);(function(e,t,r,o,s,a,n){e["GoogleAnalyticsObject"]=s;e[s]=e[s]||function(){(e[s].q=e[s].q||[]).push(arguments)},e[s].l=1*new Date;a=t.createElement(r),n=t.getElementsByTagName(r)[0];a.async=1;a.src=o;n.parentNode.insertBefore(a,n)})(r,o,"script","https://www.google-analytics.com/analytics.js","ga");(function(){var e="UA-56095-18",t="ga:clientId";if(s){ga("create",e,"auto",{storage:"none",clientId:localStorage.getItem(t)});ga(function(e){localStorage.setItem(t,e.get("clientId"))})}else{ga("create",e,"auto")}ga("set","anonymizeIp",true);ga("send","pageview")})();function n(t){var e=new XMLHttpRequest;e.open("GET","/assets/audio/"+t+".mp3",true);e.responseType="arraybuffer";e.onload=function(){d.decodeAudioData(e.response,function(e){f[t]=e},function(){})};e.send()}function y(e){if(p||!f[e]){return}if(d&&d.resume){d.resume()}var t=d.createBufferSource();t.buffer=f[e];t.connect(d.destination);if(t.start){t.start(0)}else{t.noteOn(0)}}var i={},c={player1:0,player2:0,ties:0},u={player1:0,player2:0,ties:0},l="x",m="o",f={},d,v=9,p,g,h=true,t=true,q=false,L=300,S=.75,b,w=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];function T(){for(var e=i.mute.length;e--;){i.mute[e].style.display=p?"none":""}}function M(){p=!p;if(s){localStorage.setItem("muted",p.toString())}T();a("Mute",p?"muted":"unmuted")}function A(){q=!q;var e=i.scores.scores.classList;if(q){e.remove("p1");e.add("p2");t=true}else{e.remove("p2");e.add("p1");t=false}a("Mode",q?"players":"computer");i.scores.player1.innerHTML=q?u.player1:c.player1;i.scores.player2.innerHTML=q?u.player2:c.player2;i.scores.ties.innerHTML=q?u.ties:c.ties;g=false;C()}function I(e,t){i.squares[t].querySelector("div").classList.add(e)}function k(){var e=i.scores.turn1.classList,t=i.scores.turn2.classList,r=i.scores.turnTies.classList;if(q&&i.restart.style.display==="none"){if(h){t.remove("turn");e.add("turn")}else{e.remove("turn");t.add("turn")}r.add("turn")}else{e.remove("turn");t.remove("turn");r.remove("turn")}}function E(e){if(b[e]!==0||H()||!q&&h){return}if(q){h=!h;b[e]=h?-1:1;I(h?l:m,e);y("note-"+(h?"low":"high"));H()}else{b[e]=-1;I(l,e);h=true;y("note-low");setTimeout(x,L)}k()}function D(o,s){i.restart.style.display="block";setTimeout(function(){var e="Game",t=q?"players ":"computer ";setTimeout(function(){g=false},L);if(s){for(var r=3;r--;){i.squares[s[r]].querySelector("div").classList.add("blink")}}switch(o){case l:i.scores.player1.innerHTML=q?++u.player1:++c.player1;i.scores.player1.classList.add("appear");y("game-over");a(e,t+(q?l:"lose"));break;case m:i.scores.player2.innerHTML=q?++u.player2:++c.player2;i.scores.player2.classList.add("appear");y("game-over");a(e,t+(q?m:"win"));break;default:i.scores.ties.innerHTML=q?++u.ties:++c.ties;i.scores.ties.classList.add("appear");i.board.classList.add("blink");y("game-over-tie");a(e,t+"tie");break}},h&&!q?100:L+100)}function H(){for(var e=w.length;e--;){var t=w[e],r=b[t[0]]+b[t[1]]+b[t[2]];if(r===3||r===-3){D(r===3?m:l,t);return true}}var o=0;for(e=v;e--;){if(b[e]!==0){o++}}if(o===9){D();return true}return false}function x(){if(H()){return}var e,t,r,o,s,a,n=0;h=false;k();y("note-high");for(e=v;e--;){if(b[e]!==0){n++;if(n===1){a=e}}}if(n<2&&Math.random()>.2){do{s=Math.floor(Math.random()*v)}while(s===a)}else{for(e=v;e--;){for(t=v;t--;){if(b[t]!==0){continue}b[t]=1;if(H()){I(m,t);return}b[t]=0}if(b[e]!==0){continue}b[e]=1;var i=null,c=b.concat();for(t=v;t--;){if(c[t]!==0){continue}c[t]=-1;for(r=w.length;r--;){if(c[w[r][0]]+c[w[r][1]]+c[w[r][2]]===-3&&Math.random()>S){b[e]=0;b[t]=1;I(m,t);H();return}}var u=0,l=0,f=c.concat(),d=c.concat();for(r=v;r--;){if(f[r]===0){f[r]=1}if(d[r]===0){d[r]=-1}}for(r=w.length;r--;){if(f[w[r][0]]+f[w[r][1]]+f[w[r][2]]===3){u++}if(d[w[r][0]]+d[w[r][1]]+d[w[r][2]]===-3){l++}}var p=u-l;i=i==null?p:i>p?p:i;c[t]=0}if(o==null||o<i){o=i;s=e}b[e]=0}}b[s]=1;I(m,s);H()}function B(t){i.squares[t].ontouchstart=i.squares[t].onmousedown=function(e){e.preventDefault();E(t)}}function C(){if(g){return}g=true;i.restart.style.display="none";b=[0,0,0,0,0,0,0,0,0];for(var e=v;e--;){i.squares[e].querySelector("div").className=""}i.scores.ties.classList.remove("appear");i.scores.player1.classList.remove("appear");i.scores.player2.classList.remove("appear");i.board.classList.remove("blink");h=t=!t;k();if(t&&!q){setTimeout(x,L)}}o.addEventListener("DOMContentLoaded",function(){i={board:o.querySelector(".board"),squares:o.querySelectorAll(".square"),restart:o.querySelector(".restart"),muteButton:o.querySelector(".mute"),mute:o.querySelectorAll(".mute path"),scores:{scores:o.querySelector(".scores"),swap:o.querySelector(".swap"),player1:o.querySelector(".player1 .score"),player2:o.querySelector(".player2 .score"),ties:o.querySelector(".ties .score"),turn1:o.querySelector(".player1"),turn2:o.querySelector(".player2"),turnTies:o.querySelector(".ties")}};for(var e=v;e--;){B(e)}i.restart.ontouchstart=i.scores.scores.ontouchstart=function(e){e.preventDefault()};i.scores.scores.ontouchend=i.scores.scores.onclick=function(e){e.preventDefault();A()};i.restart.ontouchend=i.restart.onclick=function(e){e.preventDefault();C()};if(r.AudioContext){d=new AudioContext;n("note-high");n("note-low");n("game-over");n("game-over-tie");p=s?localStorage.getItem("muted")==="true":false;T();i.muteButton.ontouchstart=i.muteButton.onclick=function(e){e.preventDefault();M()}}function t(){(r.adsbygoogle||[]).pauseAdRequests=0;if(s){localStorage.setItem("consent",true)}i.board.removeEventListener("mousedown",t);i.board.removeEventListener("touchstart",t)}if(s&&localStorage.getItem("consent")){(r.adsbygoogle||[]).pauseAdRequests=0}else{i.board.addEventListener("mousedown",t);i.board.addEventListener("touchstart",t)}C()})})(window,document);
